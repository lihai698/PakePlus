<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太空激战：星际防御者</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            box-shadow: 0 0 20px rgba(0, 150, 255, 0.7);
            border-radius: 10px;
            overflow: hidden;
        }
        
        canvas {
            background: linear-gradient(to bottom, #000428, #004e92);
        }
        
        #gameUI {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 15, 30, 0.85);
            color: white;
            text-align: center;
            padding: 30px;
            z-index: 10;
            pointer-events: all;
        }
        
        #menuScreen h1 {
            font-size: 3.5rem;
            color: #4cc9f0;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.8);
            margin-bottom: 20px;
            letter-spacing: 3px;
        }
        
        #menuScreen p {
            font-size: 1.1rem;
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        #gameOverScreen h2 {
            font-size: 3rem;
            color: #f72585;
            margin-bottom: 20px;
        }
        
        .btn {
            background: linear-gradient(to right, #4361ee, #3a0ca3);
            border: none;
            color: white;
            padding: 12px 35px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.6);
            background: linear-gradient(to right, #4895ef, #4361ee);
        }
        
        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px black;
            z-index: 5;
        }
        
        #scoreDisplay {
            right: 20px;
            left: auto;
        }
        
        #lives {
            display: flex;
            gap: 10px;
        }
        
        .life {
            width: 30px;
            height: 30px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23f72585' d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E") center/contain no-repeat;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="gameUI">
            <div id="menuScreen" class="screen">
                <h1>太空激战</h1>
                <p>你是人类最后的希望！在陨石雨和敌舰的包围中生存下来。使用箭头键移动，空格键射击。保护银河系的安全！</p>
                <button id="startBtn" class="btn">开始战斗</button>
                <div style="margin-top: 20px; display: flex; gap: 20px;">
                    <div>
                        <h3>控制方式:</h3>
                        <p>← → ↑ ↓ 移动飞船</p>
                        <p>空格键 - 发射武器</p>
                    </div>
                    <div>
                        <h3>游戏目标:</h3>
                        <p>摧毁陨石和敌舰获得分数</p>
                        <p>每波敌人会越来越强</p>
                    </div>
                </div>
            </div>
            
            <div id="gameOverScreen" class="screen hidden">
                <h2>任务失败</h2>
                <p>你的飞船被摧毁了！</p>
                <p id="finalScore">得分: 0</p>
                <button id="restartBtn" class="btn">再试一次</button>
            </div>
            
            <div class="hud">
                <div>生命值:</div>
                <div id="lives">
                    <div class="life"></div>
                    <div class="life"></div>
                    <div class="life"></div>
                </div>
            </div>
            
            <div class="hud" id="scoreDisplay">得分: 0</div>
        </div>
    </div>

    <script>
        // 游戏主类
        class SpaceShooter {
            constructor() {
                // 初始化Canvas和上下文
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // 游戏状态
                this.gameState = 'menu'; // menu, playing, gameOver
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                this.enemySpawnRate = 60;
                this.enemySpawnCounter = 0;
                this.isPaused = false;
                
                // 游戏对象
                this.player = null;
                this.bullets = [];
                this.enemies = [];
                this.particles = [];
                this.stars = [];
                
                // 按键状态
                this.keys = {};
                
                // 初始化
                this.init();
            }
            
            init() {
                // 创建玩家
                this.player = new Player(
                    this.canvas.width / 2 - 25,
                    this.canvas.height - 100,
                    50,
                    40
                );
                
                // 创建背景星星
                for (let i = 0; i < 150; i++) {
                    this.stars.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        size: Math.random() * 2 + 1,
                        speed: Math.random() * 2 + 1,
                        alpha: Math.random() * 0.5 + 0.5
                    });
                }
                
                // 设置事件监听
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // 键盘事件
                window.addEventListener('keydown', e => {
                    this.keys[e.key] = true;
                    
                    // 暂停/继续游戏
                    if (e.key === 'p' && this.gameState === 'playing') {
                        this.isPaused = !this.isPaused;
                    }
                });
                
                window.addEventListener('keyup', e => {
                    this.keys[e.key] = false;
                });
                
                // 按钮事件
                document.getElementById('startBtn').addEventListener('click', () => {
                    this.gameState = 'playing';
                    document.getElementById('menuScreen').classList.add('hidden');
                });
                
                document.getElementById('restartBtn').addEventListener('click', () => {
                    this.resetGame();
                    this.gameState = 'playing';
                    document.getElementById('gameOverScreen').classList.add('hidden');
                });
            }
            
            startGame() {
                if (!this.isPaused) {
                    this.update();
                    this.render();
                }
                
                requestAnimationFrame(() => this.startGame());
            }
            
            update() {
                if (this.gameState !== 'playing' || this.isPaused) return;
                
                // 更新玩家
                this.player.update(this.keys, this.canvas);
                
                // 发射子弹
                if (this.keys[' '] && this.player.shootCooldown <= 0) {
                    this.bullets.push(new Bullet(
                        this.player.x + this.player.width / 2 - 2,
                        this.player.y,
                        4,
                        10,
                        '#4cc9f0'
                    ));
                    this.player.shootCooldown = this.player.fireRate;
                }
                
                if (this.player.shootCooldown > 0) {
                    this.player.shootCooldown--;
                }
                
                // 生成敌人
                this.enemySpawnCounter++;
                if (this.enemySpawnCounter >= this.enemySpawnRate) {
                    this.spawnEnemy();
                    this.enemySpawnCounter = 0;
                    // 每级难度增加
                    this.enemySpawnRate = Math.max(20, 60 - this.level * 3);
                }
                
                // 更新子弹
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    this.bullets[i].update();
                    
                    // 移除超出屏幕的子弹
                    if (this.bullets[i].y < 0 || this.bullets[i].y > this.canvas.height) {
                        this.bullets.splice(i, 1);
                        continue;
                    }
                    
                    // 检测子弹与敌人碰撞
                    for (let j = this.enemies.length - 1; j >= 0; j--) {
                        if (this.checkCollision(this.bullets[i], this.enemies[j])) {
                            // 创建爆炸效果
                            this.createExplosion(this.enemies[j].x + this.enemies[j].width/2, 
                                                this.enemies[j].y + this.enemies[j].height/2, 
                                                10);
                            
                            // 移除子弹和敌人
                            this.bullets.splice(i, 1);
                            this.enemies.splice(j, 1);
                            
                            // 增加分数
                            this.score += 10;
                            document.getElementById('scoreDisplay').textContent = `得分: ${this.score}`;
                            
                            // 每100分提升一个等级
                            if (this.score > 0 && this.score % 100 === 0) {
                                this.level++;
                            }
                            
                            break;
                        }
                    }
                }
                
                // 更新敌人
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    this.enemies[i].update();
                    
                    // 移除超出屏幕的敌人
                    if (this.enemies[i].y > this.canvas.height) {
                        this.enemies.splice(i, 1);
                        continue;
                    }
                    
                    // 检测敌人与玩家碰撞
                    if (this.checkCollision(this.player, this.enemies[i])) {
                        // 创建爆炸效果
                        this.createExplosion(this.player.x + this.player.width/2, 
                                            this.player.y + this.player.height/2, 
                                            15);
                        
                        this.enemies.splice(i, 1);
                        this.lives--;
                        
                        // 更新生命显示
                        const livesElement = document.getElementById('lives');
                        livesElement.innerHTML = '';
                        for (let i = 0; i < this.lives; i++) {
                            const lifeDiv = document.createElement('div');
                            lifeDiv.className = 'life';
                            livesElement.appendChild(lifeDiv);
                        }
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                }
                
                // 更新粒子
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    this.particles[i].update();
                    
                    if (this.particles[i].size <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
                
                // 更新背景星星
                for (let star of this.stars) {
                    star.y += star.speed;
                    if (star.y > this.canvas.height) {
                        star.y = 0;
                        star.x = Math.random() * this.canvas.width;
                    }
                }
            }
            
            render() {
                // 清空画布
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 绘制星空背景
                this.ctx.fillStyle = 'black';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 绘制星星
                for (let star of this.stars) {
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
                    this.ctx.beginPath();
                    this.ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                // 绘制星空中的星云效果
                this.ctx.globalAlpha = 0.15;
                this.ctx.fillStyle = '#4361ee';
                this.ctx.beginPath();
                this.ctx.arc(150, 100, 80, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#f72585';
                this.ctx.beginPath();
                this.ctx.arc(600, 300, 120, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.globalAlpha = 1.0;
                
                // 绘制玩家
                this.player.draw(this.ctx);
                
                // 绘制子弹
                for (let bullet of this.bullets) {
                    bullet.draw(this.ctx);
                }
                
                // 绘制敌人
                for (let enemy of this.enemies) {
                    enemy.draw(this.ctx);
                }
                
                // 绘制粒子效果
                for (let particle of this.particles) {
                    particle.draw(this.ctx);
                }
                
                // 绘制UI元素（等级、分数等）
                this.ctx.fillStyle = 'white';
                this.ctx.font = '16px Arial';
                this.ctx.fillText(`等级: ${this.level}`, 20, 30);
                this.ctx.fillText(`得分: ${this.score}`, this.canvas.width - 120, 30);
            }
            
            spawnEnemy() {
                const enemyTypes = ['rock', 'ship'];
                const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
                
                const x = Math.random() * (this.canvas.width - 60);
                const y = -50;
                
                if (type === 'rock') {
                    const size = Math.random() * 30 + 20;
                    this.enemies.push(new Enemy(x, y, size, size, '#888', 'rock', this.canvas));
                } else {
                    this.enemies.push(new Enemy(x, y, 40, 30, '#ff6b6b', 'ship', this.canvas));
                }
            }
            
            createExplosion(x, y, count) {
                for (let i = 0; i < count; i++) {
                    this.particles.push(new Particle(
                        x, y,
                        Math.random() * 5 - 2.5,
                        Math.random() * 5 - 2.5,
                        Math.random() * 8 + 4,
                        `hsl(${Math.random() * 60}, 100%, 50%)`,
                        Math.random() * 0.5 + 0.5
                    ));
                }
            }
            
            checkCollision(obj1, obj2) {
                return obj1.x < obj2.x + obj2.width &&
                       obj1.x + obj1.width > obj2.x &&
                       obj1.y < obj2.y + obj2.height &&
                       obj1.y + obj1.height > obj2.y;
            }
            
            gameOver() {
                this.gameState = 'gameOver';
                document.getElementById('finalScore').textContent = `得分: ${this.score}`;
                document.getElementById('gameOverScreen').classList.remove('hidden');
            }
            
            resetGame() {
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                this.player.x = this.canvas.width / 2 - 25;
                this.player.y = this.canvas.height - 100;
                this.bullets = [];
                this.enemies = [];
                this.particles = [];
                
                // 更新UI
                document.getElementById('scoreDisplay').textContent = `得分: ${this.score}`;
                const livesElement = document.getElementById('lives');
                livesElement.innerHTML = '';
                for (let i = 0; i < this.lives; i++) {
                    const lifeDiv = document.createElement('div');
                    lifeDiv.className = 'life';
                    livesElement.appendChild(lifeDiv);
                }
            }
        }

        // 玩家类
        class Player {
            constructor(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.speed = 6;
                this.fireRate = 10;
                this.shootCooldown = 0;
            }
            
            update(keys, canvas) {
                // 移动控制
                if (keys['ArrowLeft'] || keys['a']) {
                    this.x = Math.max(0, this.x - this.speed);
                }
                if (keys['ArrowRight'] || keys['d']) {
                    this.x = Math.min(canvas.width - this.width, this.x + this.speed);
                }
                if (keys['ArrowUp'] || keys['w']) {
                    this.y = Math.max(0, this.y - this.speed);
                }
                if (keys['ArrowDown'] || keys['s']) {
                    this.y = Math.min(canvas.height - this.height, this.y + this.speed);
                }
            }
            
            draw(ctx) {
                // 绘制飞船主体
                ctx.fillStyle = '#4cc9f0';
                ctx.beginPath();
                ctx.moveTo(this.x + this.width / 2, this.y);
                ctx.lineTo(this.x, this.y + this.height);
                ctx.lineTo(this.x + this.width, this.y + this.height);
                ctx.closePath();
                ctx.fill();
                
                // 绘制飞船引擎
                ctx.fillStyle = '#4895ef';
                ctx.fillRect(this.x + 15, this.y + this.height, 20, 10);
                
                // 绘制引擎火焰
                ctx.fillStyle = '#f72585';
                ctx.beginPath();
                ctx.moveTo(this.x + 15, this.y + this.height + 10);
                ctx.lineTo(this.x + 25, this.y + this.height + 20);
                ctx.lineTo(this.x + 25, this.y + this.height + 10);
                ctx.closePath();
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(this.x + 35, this.y + this.height + 10);
                ctx.lineTo(this.x + 25, this.y + this.height + 20);
                ctx.lineTo(this.x + 25, this.y + this.height + 10);
                ctx.closePath();
                ctx.fill();
            }
        }

        // 敌人类
        class Enemy {
            constructor(x, y, width, height, color, type, canvas) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.type = type;
                this.speed = Math.random() * 3 + 1;
                this.canvas = canvas;
                
                if (type === 'ship') {
                    // 敌舰会有左右移动模式
                    this.direction = Math.random() > 0.5 ? 1 : -1;
                    this.oscillation = Math.random() * 0.1;
                    this.oscillationSpeed = Math.random() * 0.05 + 0.02;
                }
            }
            
            update() {
                this.y += this.speed;
                
                if (this.type === 'ship') {
                    // 敌舰左右摇摆前进
                    this.x += Math.sin(this.y * this.oscillationSpeed) * this.oscillation;
                    this.x = Math.max(0, Math.min(this.canvas.width - this.width, this.x));
                } else if (this.type === 'rock') {
                    // 陨石旋转下落
                    this.rotation = (this.rotation || 0) + 0.02;
                }
            }
            
            draw(ctx) {
                if (this.type === 'rock') {
                    // 绘制陨石
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2, this.y + this.height/2, this.width/2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // 陨石表面纹理
                    ctx.fillStyle = '#666';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/3, this.y + this.height/3, this.width/6, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(this.x + this.width * 2/3, this.y + this.height * 2/3, this.width/4, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // 绘制敌舰
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    // 敌舰顶部
                    ctx.fillStyle = '#ff5252';
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + this.width, this.y);
                    ctx.lineTo(this.x + this.width/2, this.y - 10);
                    ctx.closePath();
                    ctx.fill();
                    
                    // 敌舰引擎
                    ctx.fillStyle = '#ffb142';
                    ctx.fillRect(this.x + 10, this.y + this.height, 7, 7);
                    ctx.fillRect(this.x + this.width - 17, this.y + this.height, 7, 7);
                }
            }
        }

        // 子弹类
        class Bullet {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.speed = 8;
            }
            
            update() {
                this.y -= this.speed;
            }
            
            draw(ctx) {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // 添加发光效果
                ctx.fillStyle = 'white';
                ctx.globalAlpha = 0.7;
                ctx.fillRect(this.x + 1, this.y, 2, this.height);
                ctx.globalAlpha = 1.0;
            }
        }

        // 粒子类
        class Particle {
            constructor(x, y, vx, vy, size, color, alpha) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.size = size;
                this.color = color;
                this.alpha = alpha;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.size -= 0.15;
                this.alpha -= 0.015;
            }
            
            draw(ctx) {
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }
        }

        // 启动游戏
        document.addEventListener('DOMContentLoaded', () => {
            const game = new SpaceShooter();
            game.startGame();
        });
    </script>
</body>
</html>